function PSD=ksmoothspec(w,sp,frsm)%function PSD=ksmoothspec(w,sp,frsm)%Geometrically smooth a spectrum, over a fraction frsm%of the total bandwidth.%Smooth the spectrum%frsm=1/40;%w=f;%sp=P;if frsm==0	PSD=sp;	return;endlk=log10(w);lk(isinf(lk)) = nan; lkr= max(lk)-min(lk);dlk=frsm*lkr;[m,n]=size(sp);PSD=zeros(m,n);for c=1:length(w)	ind=find(lk > lk(c) - dlk/2 & lk < lk(c) + dlk/2);	PSD(c)=mean(sp(ind)); end